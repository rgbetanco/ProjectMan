class CSBaseVirtualList{constructor(t,e={}){var r=this;((t=r.e(t)).csList=r).t=t,r.r(t,e)}r(t,e){let a=this;a.s(e,"onInitRow");var r=a.i(e.w)?e.w+"px":"100%",s=a.i(e.h)?e.h+"px":"100%";a.l=e.rowHeight,a.n=a.a(a.l,30),a.o=e.onNewRow,a.u=e.onEmptyRow,a.c=a.a(e.minSelItems,0),a.d=a.a(e.maxSelItems,0),a.v=new Set;s=a.f(t,r,s);let i=a._=s[0],l=a.g=s[1];a.p=a.b(i,a.C()),a.m=a.b(i,a.C()),a.S=a.R=0,a.totalRows=a.a(e.totalRows,0),l.addEventListener("scroll",t=>{a.x(t.target.scrollTop)}),i.addEventListener("click",t=>{var e,r,s,i,l,n=a.getCellRow(t.target);null!=n&&(e=n[0],l=n[1],e!=a.y&&(r=parseInt(e.dataset.index),s=a.c,0!=(i=a.d)&&(n=a.v.size,a.v.has(r)?-1!=s||t.ctrlKey||t.metaKey?(s<=0||s<i&&-1!=i&&i<n)&&(a.v.delete(r),a.I(e)):(a.clearSelection(),a.v.add(r),a.V(e)):(-1!=s||t.ctrlKey||t.metaKey?s<=i&&-1!=i&&n==i&&([i]=a.v,a.unselectIndex(i)):a.clearSelection(),a.v.add(r),a.V(e))),l=a.getCellInfo(l),a.A("clickcell",{data:a.$?a.D[r]:null,row:r,col:l[0],fieldname:l[2],td:l[1],tr:e})))}),a.L(l,()=>a.P())}addEventListener(t,e){this.t.addEventListener(t,e)}get totalRows(){return this.z}set totalRows(t){var e=this;e.B=0,e.i(e.l)?delete e.F:(e.k=new Array(t+1),e.F=new Array(t+1),e.F[0]=0),e.H(0,0),e.z=t,e.P()}get rowHeight(){return this.l}set rowHeight(t){var e=this;t!=e.l&&(e.l=t,e.totalRows=e.z)}getCellRow(t){for(;null!=t;){if(t==self._)return null;if("index"in t.dataset)return[t,null];t=t.parentElement}return null}getCellInfo(t){return[-1,null,null]}getRowAtIndex(t){var e=this;return t>=e.S&&t<=e.R?e._.childNodes[t-e.S+1]:null}get selections(){return this.v}selectIndex(t){var e=this;e.V(e.getRowAtIndex(t)),e.v.add(t)}unselectIndex(t){var e=this;e.I(e.getRowAtIndex(t)),e.v.delete(t)}clearSelection(){let e=this;e._.childNodes.forEach(t=>e.I(t)),e.v.clear()}isIndexSelected(t){return this.selection.has(t)}x(e){var r=this;if(r.i(r.F)){var s=r.z-1,i=r.M;let t=r.O(e,0,s);(t<r.S||r.O(e+i,t+1,s)>=r.R)&&(t=2*(r.O(e-i,0,s)>>1),t<0&&(t=0),r.H(t,r.O(e+2*i,t+1,s)+1))}else{let t=parseInt(e/r.n);e=Math.ceil(r.M/r.n);(t<r.S||t>=r.R-e)&&(t-=e,t=t<0?0:2*(t>>1),r.H(t,t+3*e))}}T(t){this.n=t}O(t,e,r){for(;e<=r;){var s=e+r>>1,i=this.j(s);if(i<t)e=1+s;else{if(!(t<i))return s;r=s-1}}return this.j(e)>=t?e:e-1}j(t){var e=this,r=t-e.B;return 0<r?r*e.n+e.F[e.B]:e.F[t]}V(t){this.Q(t)&&t.classList.add("selected")}I(t){this.Q(t)&&t.classList.remove("selected")}P(){var t=this,e=window.getComputedStyle(t.g),e=t.g.clientHeight-parseFloat(e.paddingTop)-parseFloat(e.paddingBottom);t.M=e,t.x(t.g.scrollTop)}H(e,r){var i=this,l=i._;r>i.z&&(r=i.z);var t,s=(e,r)=>{let s=l.childNodes[e];for(let t=e;t>r;t--){var i=s;s=s.previousSibling,l.removeChild(i)}};let n=0==i.B,a=i.B,h,o=i.k,u=i.i(i.l)?(t,e,r)=>{var s=document.createDocumentFragment();for(h=e;h<r;h++){let t=i.o(h,i);t.dataset.index=h,t.style.height=`${i.l}px`,i.v.has(h)&&i.V(t),i.i(i.onInitRow)&&i.onInitRow(t,h,i),i.b(s,t)}l.insertBefore(s,t),e<r&&(t=i.G(t.previousSibling),i.n!=t&&0<t&&i.T(t))}:(e,t,r)=>{if(i.B<r){for(h=i.B;h<r;h++)o[h]=i.n;i.B=r}for(h=t;h<r;h++){let t=i.o(h,i);t.dataset.index=h,i.i(i.onInitRow)&&i.onInitRow(t,h,i),l.insertBefore(t,e);var s=i.G(t);o[h]!=s&&(o[h]=s,a>h&&(a=h))}n&&(t=i.G(e.previousSibling),i.n!=t&&0<t&&i.T(t))};0==i.z?i.i(i.u)&&((t=i.C()).classList.add("cs-table-msg-row"),i.u(t),i.i(i.y)?i.y.replaceWith(t):l.insertBefore(t,i.m),i.y=t):i.i(i.y)&&(l.removeChild(i.y),delete i.y),r<i.R&&s(i.R-i.S,Math.max(0,r-i.S)),e>i.S&&s(Math.min(e,i.R)-i.S,0),e<i.S&&u(i._.childNodes[1],e,Math.min(r,i.S)),r>i.R&&u(i.m,Math.max(e,i.R),r),i.S=e,i.R=r;let c,d;if(i.i(i.l))c=e*i.n,d=(i.z-r)*i.n;else{let t=i.F;for(h=a;h<i.B;h++)t[h+1]=t[h]+o[h];c=t[e],d=t[i.B]-t[r]+i.n*(i.z-i.B)}i.p.style.height=`${c}px`,i.m.style.height=`${d}px`}f(t,e,r){t=this.N(t,"div");return t.style.cssText=`width:${e};height:${r};overflow:auto;`,[t,t]}C(){return this.U("div")}q(t){return this.N(t,"div")}A(t,e){this.t.dispatchEvent(new CustomEvent(t,{detail:Object.assign({table:self},e),bubbles:!0}))}U(t){return document.createElement(t)}b(t,e){return t.appendChild(e)}J(t,e){t.removeChild(e)}N(t,e){return this.b(t,this.U(e))}K(t,e){return Object.assign({},t,e)}G(t){var e=getComputedStyle(t);return parseInt(e.marginTop)+parseInt(e.marginBottom)+t.offsetHeight}i(t){return void 0!==t}Q(t){return t instanceof Node}W(t){return"TABLE"==t.tagName.toUpperCase()}a(t,e){return this.i(t)?t:e}s(e,...r){for(let t of r){var s=this.t.dataset["cs"+t.charAt(0).toUpperCase()+t.slice(1)];return this[t]=this.a(e[t],window[s])}}e(t){return this.Q(t)?t:t.startsWith("#")?document.getElementById(t.substr(1)):null}L(t,e){"ResizeObserver"in window?(this.X=new ResizeObserver(e),this.X.observe(t)):this.L({target:t,size:{w:t.clientWidth,h:t.clientHeight}},e)}Y(t,e){var r=t.target.clientWidth,s=t.target.clientHeight;t.size.w==r&&t.size.h==s||(t.size.w=r,t.size.h=s,e(t)),window.requestAnimationFrame(()=>this.Y(t,e))}}class CSVirtualList extends CSBaseVirtualList{constructor(t,e={}){super(t,e)}static getInstance(t){return t.csList instanceof CSVirtualList?t.csList:null}r(t,e){var r=this;r.s(e,"onPrepareFetch"),r.fetchOptions=e.fetchOptions,r.downloadMsg=e.downloadMsg,(r.i(e.nullDataMsg)||r.i(e.emptyDataMsg))&&(r.emptyDataMsg=e.emptyDataMsg,r.nullDataMsg=r.a(e.nullDataMsg,e.emptyDataMsg),e.onEmptyRow=t=>{let e=r.q(t);return e.innerText=r.$?r.emptyDataMsg:r.nullDataMsg,t}),super.r(t,e),r.i(t.dataset.csAutoload)&&"true"!=t.dataset.csAutoload||r.fetch()}get data(){return this.D}set data(t){var e=this;e.D=null==t||Array.isArray(t)?t:t.rows,e.Z(),e.refresh(),e.A("datachange",{data:e.tt})}get tt(){return this.$?this.D:[]}get $(){return Array.isArray(this.D)}refresh(){this.totalRows=this.tt.length}fetch(i={}){var l=this,n=l.t.dataset.csUrl;if(l.i(n)){let t=l.U("div");t.classList.add("cs-table-msg");let e=l.N(t,"div");e.classList.add("cs-waiting-icon");let r=l.N(t,"h5");r.innerText=l.a(l.downloadMsg,"");let s=l.g;s.parentNode.insertBefore(t,s),s.style.display="hidden";var a=l.K(l.fetchOptions,i),h=new URLSearchParams;l.et(h),l.i(l.onPrepareFetch)&&l.onPrepareFetch(h,i,l),n+=(-1!==n.indexOf("?")?"&":"?")+h.toString(),fetch(n,a).then(t=>{if(!t.ok)throw t;return t.json()}).then(t=>{l.data=t}).catch(t=>{var e;l.i(a.failure)&&(e=t instanceof Response,a.failure(e?t.statusText:t,e?t:null,l)),l.data=null}).finally((s.parentNode.removeChild(t),void(s.style.display="")))}}setDataValue(t,e,r,s){this.getDataValue(t,e)[r]=s}setDataValue(e,r){var t=this.D.findIndex(t=>t[e]==r[e]);this.D[t]=r}getDataValue(e,r){return this.D.find(t=>t[e]==r)}Z(){}et(t){}rt(s,t,e){if(this.$)if(""==t||"local"==t)this.D.sort(e?(t,e)=>{t=t[s],e=e[s];return(null===t)-(null===e)||-(e<t)||+(t<e)}:(t,e)=>{t=t[s],e=e[s];return(null===t)-(null===e)||+(e<t)||-(t<e)});else{let r=window[t];this.D.sort(e?(t,e)=>r(e[s],t[s]):(t,e)=>r(t[s],e[s]))}}}class CSTable extends CSVirtualList{constructor(t,e={}){super(t,e)}static getInstance(t){return t.csList instanceof CSTable?t.csList:null}r(l,t){let n=this;const a="desc";var e="cs-sort-";const h=e+"asc",o=e+a;l.classList.add("cs-table");var r=l.getElementsByTagName("thead");if(1!=r.length)throw`table ${l.id} needs exactly one thead`;e=n.st=r[0].getElementsByTagName("th"),r=n.N(l,"tbody"),r=n.N(r,"tr"),r=n.q(r);r.style.padding="0",t.onNewRow=(r,s)=>{var i=s.U("tr");if(s.tt.length>r)for(var l of s.st){l=l.dataset;let t=s.N(i,"td"),e=s.D[r][l.csField];s.i(l.csFormatter)&&(e=window[l.csFormatter](e,r,s)),s.Q(e)?s.b(t,e):t.innerText=e}return i};for(let i of e)if(n.i(i.dataset.csSortable)&&""!=i.dataset.csSortable){let r=i.classList;r.add("cs-sortable");let s=l.dataset;s.csSortField==i.dataset.csField&&r.add(s.csSortOrder==a?o:h),i.addEventListener("click",()=>{var t=s.csSortField,e=i.dataset.csField;t!=e?(!n.i(t)||(t=n.it(t))&&t.classList.remove(o,h),r.add(h),s.csSortField=e,s.csSortOrder="asc","server"==i.dataset.csSortable?n.fetch():(n.rt(e,i.dataset.csSortable,s.csSortOrder==a),n.refresh())):(s.csSortOrder==a?(r.remove(o),r.add(h),l.dataset.csSortOrder="asc"):(r.remove(h),r.add(o),l.dataset.csSortOrder=a),n.$&&(n.D.reverse(),n.refresh()))})}super.r(r,t)}getCellRow(s){for(;null!=s;){let t,e,r=null;if(null==(t=s.closest("td"))?t=s:r=t,null==(e=t.closest("tr"))&&(e=s),(s=e.closest("tbody"))==this._)return[e,r];null!=s&&(s=s.parentElement)}return null}getCellInfo(t){if(null==t)return[-1,null,null];var e=t.cellIndex;return[e,t,this.st[e].dataset.csField]}f(t,e,r){t=this.N(t,"div");t.style.cssText=`width:${e};height:${r};overflow:auto;`;var e=this.N(t,"table"),r=this.t.classList,s=e.classList;return r.forEach(t=>{t.startsWith("table")&&s.add(t)}),r.remove("table-striped","table-hover"),[this.N(e,"tbody"),t]}H(t,e){super.H(t,e);if(this.S<this.R){var r=this._.childNodes[1].childNodes;for(let t=0;t<r.length;t++)this.st[t].style.width=r[t].offsetWidth+"px"}}C(){return this.U("tr")}q(t){let e=this.N(t,"td");return e.colSpan=this.st.length,e}it(t){t=this.t.querySelectorAll(`[data-cs-field="${t}"]`);return 1<=t.length?t[0]:null}Z(){var t,e=this.t.dataset,r=e.csSortField;this.i(r)&&(null==(t=this.it(r))||"server"!=(t=t.dataset.csSortable)&&this.rt(r,t,"desc"==e.csSortOrder))}et(t){var e,r=this.t.dataset,s=r.csSortField;!this.i(s)||null!=(e=this.it(s))&&"server"==e.dataset.csSortable&&(t.sort=s,t.order="desc"==r.csSortOrder?"desc":"asc")}}
//# sourceMappingURL=cstable.min.js.map